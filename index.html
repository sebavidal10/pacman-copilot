<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Pac-Man Noir</title>
    <style>
        body { background: #000; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; font-family: 'Courier New', monospace; }
        #game-container { position: relative; border: 2px solid #333; box-shadow: 0 0 20px rgba(255,255,255,0.05); }
        canvas { display: block; }
        .stats { margin-bottom: 10px; font-size: 1.2rem; letter-spacing: 2px; }
    </style>
</head>
<body>
    <div class="stats">SCORE: <span id="score">0</span></div>
    <div id="game-container">
        <canvas id="pacmanCanvas" width="380" height="380"></canvas>
    </div>

<script>
const canvas = document.getElementById('pacmanCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');

const TILE_SIZE = 20;
let score = 0;

// 1 = Muro, 0 = Punto, 2 = Vacío
const map = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,0,1],
    [1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1],
    [1,1,1,1,0,1,1,1,2,1,2,1,1,1,0,1,1,1,1],
    [1,1,1,1,0,1,2,2,2,2,2,2,2,1,0,1,1,1,1],
    [1,1,1,1,0,1,2,1,1,2,1,1,2,1,0,1,1,1,1],
    [2,2,2,2,0,2,2,1,2,2,2,1,2,2,0,2,2,2,2],
    [1,1,1,1,0,1,2,1,1,1,1,1,2,1,0,1,1,1,1],
    [1,1,1,1,0,1,2,2,2,2,2,2,2,1,0,1,1,1,1],
    [1,1,1,1,0,1,2,1,1,1,1,1,2,1,0,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,0,1],
    [1,0,0,1,0,0,0,0,0,2,0,0,0,0,0,1,0,0,1],
    [1,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,1],
    [1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

let player = { x: 9 * TILE_SIZE, y: 15 * TILE_SIZE, dir: 0, nextDir: 0, speed: 2 };

function drawMap() {
    for(let row = 0; row < map.length; row++) {
        for(let col = 0; col < map[row].length; col++) {
            let x = col * TILE_SIZE;
            let y = row * TILE_SIZE;
            if(map[row][col] === 1) {
                ctx.fillStyle = '#1a1a2e';
                ctx.fillRect(x, y, TILE_SIZE, TILE_SIZE);
                ctx.strokeStyle = '#16213e';
                ctx.strokeRect(x, y, TILE_SIZE, TILE_SIZE);
            } else if(map[row][col] === 0) {
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(x + TILE_SIZE/2, y + TILE_SIZE/2, 2, 0, Math.PI*2);
                ctx.fill();
            }
        }
    }
}

function canMove(x, y) {
    let col = Math.floor(x / TILE_SIZE);
    let row = Math.floor(y / TILE_SIZE);
    let col2 = Math.ceil(x / TILE_SIZE);
    let row2 = Math.ceil(y / TILE_SIZE);
    return map[row][col] !== 1 && map[row][col2] !== 1 && map[row2][col] !== 1 && map[row2][col2] !== 1;
}

function update() {
    // Intentar cambiar de dirección solo si estamos alineados a la grilla
    if (player.x % TILE_SIZE === 0 && player.y % TILE_SIZE === 0) {
        // Comer punto
        let r = player.y / TILE_SIZE;
        let c = player.x / TILE_SIZE;
        if (map[r][c] === 0) {
            map[r][c] = 2;
            score += 10;
            scoreEl.innerText = score;
        }

        if (player.nextDir === 'Up' && canMove(player.x, player.y - TILE_SIZE)) player.dir = 'Up';
        if (player.nextDir === 'Down' && canMove(player.x, player.y + TILE_SIZE)) player.dir = 'Down';
        if (player.nextDir === 'Left' && canMove(player.x - TILE_SIZE, player.y)) player.dir = 'Left';
        if (player.nextDir === 'Right' && canMove(player.x + TILE_SIZE, player.y)) player.dir = 'Right';
    }

    if (player.dir === 'Up' && canMove(player.x, player.y - player.speed)) player.y -= player.speed;
    if (player.dir === 'Down' && canMove(player.x, player.y + player.speed)) player.y += player.speed;
    if (player.dir === 'Left' && canMove(player.x - player.speed, player.y)) player.x -= player.speed;
    if (player.dir === 'Right' && canMove(player.x + player.speed, player.y)) player.x += player.speed;
}

function drawPlayer() {
    ctx.fillStyle = '#ff0';
    ctx.beginPath();
    ctx.arc(player.x + TILE_SIZE/2, player.y + TILE_SIZE/2, TILE_SIZE/2 - 2, 0.2 * Math.PI, 1.8 * Math.PI);
    ctx.lineTo(player.x + TILE_SIZE/2, player.y + TILE_SIZE/2);
    ctx.fill();
}

function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawMap();
    update();
    drawPlayer();
    requestAnimationFrame(gameLoop);
}

document.addEventListener('keydown', (e) => {
    player.nextDir = e.key.replace('Arrow', '');
});

gameLoop();
</script>
</body>
</html>